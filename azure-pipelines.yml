stages:
- stage: Build
  displayName: Build the web application
  jobs:
  - job: Build
    displayName: Build job
    pool:
      name: 'SecureAgents-aoude'

    steps:
    - checkout: self

    - task: UseDotNet@2
      displayName: Use .NET SDK 8.x
      inputs:
        version: '8.x'

    - task: Npm@1
      displayName: Run npm install
      inputs:
        command: 'install'
        workingDir: '$(Build.SourcesDirectory)/Tailspin.SpaceGame.Web'

    - script: |
        cd $(Build.SourcesDirectory)/Tailspin.SpaceGame.Web
        npx node-sass ./wwwroot --output ./wwwroot
      displayName: Compile Sass assets

    - script: |
        echo "$(Build.DefinitionName), $(Build.BuildId), $(Build.BuildNumber)" > buildinfo.txt
      workingDirectory: '$(Build.SourcesDirectory)/Tailspin.SpaceGame.Web/wwwroot'
      displayName: Write build info

    - task: DotNetCoreCLI@2
      displayName: Publish
      inputs:
        command: publish
        projects: '**/*.csproj'
        arguments: '--configuration Release --output $(Build.ArtifactStagingDirectory)/Release'
        zipAfterPublish: true

    - publish: '$(Build.ArtifactStagingDirectory)'
      artifact: drop
